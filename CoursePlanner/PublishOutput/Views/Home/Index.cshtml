@using CoursePlanner.Controllers
@using CoursePlanner.Models
@model IEnumerable<Course>

@{
    ViewBag.Title = "Course Conflict Overview";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- Section with Table Population Code -->
<!-- #region-->

@helper PopulateTerm(CourseOccurrence currentCourse)
{
//Courses starting period 1

if (currentCourse.Period.ToString().Substring(0, 2) == Periods.P1.ToString())
{
    var numPeriods = currentCourse.Period.ToString().Length;
    if (numPeriods == 2)
    {
        if (currentCourse.Term == Terms.Spring)
        {
            @FillEmptyTerm()
        }
        <td>
            @MakeCourseBox(currentCourse)
        </td>
        <td colspan="3"></td>
        if (currentCourse.Term == Terms.Fall)
        {
            @FillEmptyTerm()
        }
    }
    if (numPeriods == 4)
    {
        if (currentCourse.Term == Terms.Spring)
        {
            @FillEmptyTerm()
        }
        <td colspan="2">
            @MakeCourseBox(currentCourse)
        </td>
        <td colspan="2"></td>
        if (currentCourse.Term == Terms.Fall)
        {
            @FillEmptyTerm()
        }
    }
    if (numPeriods == 6)
    {
        if (currentCourse.Term == Terms.Spring)
        {
            @FillEmptyTerm()
        }
        <td colspan="3">
            @MakeCourseBox(currentCourse)
        </td>
        <td></td>
        if (currentCourse.Term == Terms.Fall)
        {
            @FillEmptyTerm()
        }
    }
    if (numPeriods == 8)
    {
        if (currentCourse.Term == Terms.Spring)
        {
            @FillEmptyTerm()
        }
        <td colspan="4">
            @MakeCourseBox(currentCourse)
        </td>
        if (currentCourse.Term == Terms.Fall)
        {
            @FillEmptyTerm()
        }
    }
}

//Courses starting period 2
if (currentCourse.Period.ToString().Substring(0, 2) == Periods.P2.ToString())
{
    var numPeriods = currentCourse.Period.ToString().Length;
    if (numPeriods == 2)
    {
        if (currentCourse.Term == Terms.Spring)
        {
            @FillEmptyTerm()
        }
        <td></td>
        <td>
            @MakeCourseBox(currentCourse)
        </td>
        <td colspan="2"></td>
        if (currentCourse.Term == Terms.Fall)
        {
            @FillEmptyTerm()
        }
    }
    if (numPeriods == 4)
    {
        if (currentCourse.Term == Terms.Spring)
        {
            @FillEmptyTerm()
        }
        <td></td>
        <td colspan="2">
            @MakeCourseBox(currentCourse)
        </td>
        <td></td>
        if (currentCourse.Term == Terms.Fall)
        {
            @FillEmptyTerm()
        }
    }
    if (numPeriods == 6)
    {
        if (currentCourse.Term == Terms.Spring)
        {
            @FillEmptyTerm()
        }
        <td></td>
        <td colspan="3">
            @MakeCourseBox(currentCourse)
        </td>
        if (currentCourse.Term == Terms.Fall)
        {
            @FillEmptyTerm()
        }
    }
}

//Courses starting period 3
if (currentCourse.Period.ToString().Substring(0, 2) == Periods.P3.ToString())
{
    var numPeriods = currentCourse.Period.ToString().Length;
    if (numPeriods == 2)
    {
        if (currentCourse.Term == Terms.Spring)
        {
            @FillEmptyTerm()
        }
        <td colspan="2"></td>
        <td>
            @MakeCourseBox(currentCourse)
        </td>
        <td></td>
        if (currentCourse.Term == Terms.Fall)
        {
            @FillEmptyTerm()
        }
    }
    if (numPeriods == 4)
    {
        if (currentCourse.Term == Terms.Spring)
        {
            @FillEmptyTerm()
        }
        <td></td>
        <td></td>
        <td colspan="2">
            @MakeCourseBox(currentCourse)
        </td>
        if (currentCourse.Term == Terms.Fall)
        {
            @FillEmptyTerm()
        }
    }
}
//Courses starting period 4
if (currentCourse.Period.ToString().Substring(0, 2) == Periods.P4.ToString())
{
    var numPeriods = currentCourse.Period.ToString().Length;
    if (numPeriods == 2)
    {
        if (currentCourse.Term == Terms.Spring)
        {
           @FillEmptyTerm()
        }
        <td colspan="3"></td>
        <td>
            @MakeCourseBox(currentCourse)
        </td>
        if (currentCourse.Term == Terms.Fall)
        {
            @FillEmptyTerm()
        }
    }
}
}

@helper MakeCourseBox(CourseOccurrence course)
{
    <div class="perioditem normal">@course.Budget.ToString()</div>
}

@helper FillEmptyTerm()
{
    <td colspan="4"></td>
}

<!-- #endregion -->



<div class="row">
    <div class="col-xs-12">
        <div class="box-group" id="accordion">
            <div class="panel box box-danger">
                <div class="box-header with-border">
                    <h4 class="box-title">
                        <a class="CollapsableLinkHeader" data-toggle="collapse" data-parent="#accordion" href="#conflictColorsCollapse">
                            Conflict classification descripitions (click to view/collapse)
                        </a>
                    </h4>
                </div>
                <div id="conflictColorsCollapse" class="panel-collapse collapse">
                    <div class="box-body">
                        <div class="periodContainer callout callout-info">
                            <b>Notification</b>
                            <p>Identifies a course with non-hour related issues.</p>
                        </div>
                        <div class="periodContainer callout callout-success">
                            <b>No issue</b>
                            <p>Identifies a course with no outstanding issues.</p>
                        </div>
                        <div class="periodContainer callout callout-warning">
                            <b>Minor hour issue</b>
                            <p>Identifies a course thats allocated +- 10 to 50 hours.</p>
                        </div>
                        <div class="periodContainer callout callout-danger">
                            <b>Major hour issue</b>
                            <p> Identifies a course thats allocated +- >50 hours.</p>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-xs-12">
        <div class="box box-danger">
            <!-- /.box-header -->
            <div class="box-body">
                @using (Html.BeginForm("Index", "Home", FormMethod.Post, new { @class = "form-inline" }))
                {
                    <div class="col-md-3 col-xs-6">
                        <fieldset>
                            <p class="courseoveriewfilterhead">Term(s):</p>
                            <div class="form-group checkbox-inline">
                                <label class="font-light courseoveriewfilterhead">
                                    @Html.CheckBox("fall", true) Fall
                                </label>
                            </div>
                            <div class="form-group checkbox-inline">
                                <label class="font-light courseoveriewfilterhead">
                                    @Html.CheckBox("spring", true) Spring
                                </label>
                            </div>
                        </fieldset>
                    </div>
                    <div class="col-md-4 col-xs-8">
                        <fieldset>
                            <p class="courseoveriewfilterhead">Period(s): </p>
                            <div class="form-group checkbox-inline font-light">
                                <label class="font-light courseoveriewfilterhead">
                                    @Html.CheckBox("P1", true) P1
                                </label>
                            </div>
                            <div class="form-group checkbox-inline font-light">
                                <label class="font-light courseoveriewfilterhead">
                                    @Html.CheckBox("P2", true) P2
                                </label>
                            </div>
                            <div class="form-group checkbox-inline font-light">
                                <label class="font-light courseoveriewfilterhead">
                                    @Html.CheckBox("P3", true) P3
                                </label>
                            </div>
                            <div class="form-group checkbox-inline">
                                <label for="P4" class="font-light courseoveriewfilterhead">
                                    @Html.CheckBox("P4", true) P4
                                </label>

                            </div>
                        </fieldset>
                    </div>

                    <div class="col-md-1 col-xs-1">
                        <button class="btn btn-sm btn-danger" type="submit">Filter</button>
                    </div>
                }


                <table id="courseconflictoverview" class="table table-bordered table-hover">
                    <thead>
                        <tr>
                            <th class="wide-row"></th>
                            <th colspan="4">Fall</th>
                            <th colspan="4">Spring</th>
                        </tr>
                        <tr>
                            <th>Course</th>
                            <th>P1</th>
                            <th>P2</th>
                            <th>P3</th>
                            <th>P4</th>
                            <th>P1</th>
                            <th>P2</th>
                            <th>P3</th>
                            <th>P4</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            if (item.CourseOccurrence.Where(x => x.Year == HomeController.CurrentSchoolYear()).ToList().Count > 0)
                            {
                                var currentCourse = item.CourseOccurrence.Where(x => x.Year == HomeController.CurrentSchoolYear()).ToList().First();

                                <tr class='clickable-row' data-href='@Url.Action("Details", "Course", new {id = item.CourseId})'>
                                    <td>@Html.DisplayFor(modelItem => item.CourseName)</td>

                                    @PopulateTerm(currentCourse)
                                    
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
            <!-- /.box-body -->
        </div>
        <!-- /.box -->
    </div>
</div>


@section MyScripts{
    <script>
        $(document).ready(function () {
            $(".clickable-row").click(function () {
                window.location.href = $(this).data("href");
            });
        });
    </script>
    <script>
        $(function () {
            $('#courseconflictoverview').DataTable({
                'paging': false,
                'lengthChange': false,
                'searching': true,
                'ordering': false,
                'info': false,
                'autoWidth': false,
                'columnDefs': [
                    {
                        'targets': '_all',
                        'defaultContent': ''
                    }
                ]
            });
        })
    </script>
}