@model IEnumerable<CoursePlanner.Models.RequestApprovalMessage>

@{
    ViewBag.Title = "Index";
}

<h2>Message Box</h2>
<style>
    h1 {
        visibility: hidden;
    }


    /* CSS used here will be applied after bootstrap.css */
    .btn-default-green {
        color: #333;
        background-color: #fff;
        border-color: #ccc;
    }

        .btn-default-green:focus,
        .btn-default-green.focus {
            color: #00ff7f;
            background-color: #e6e6e6;
            border-color: #8c8c8c;
        }

        .btn-default-green:hover {
            color: #333;
            background-color: #e6e6e6;
            border-color: #adadad;
        }

        .btn-default-green:active,
        .btn-default-green.active,
        .open > .dropdown-toggle.btn-default-green {
            color: #008000;
            background-color: #e6e6e6;
            border-color: #adadad;
        }

            .btn-default-green:active:hover,
            .btn-default-green.active:hover,
            .open > .dropdown-toggle.btn-default-green:hover,
            .btn-default-green:active:focus,
            .btn-default-green.active:focus,
            .open > .dropdown-toggle.btn-default-green:focus,
            .btn-default-green:active.focus,
            .btn-default-green.active.focus,
            .open > .dropdown-toggle.btn-default-green.focus {
                color: #008000;
                background-color: #d4d4d4;
                border-color: #8c8c8c;
            }

        .btn-default-green:active,
        .btn-default-green.active,
        .open > .dropdown-toggle.btn-default-green {
            background-image: none;
        }

        .btn-default-green.disabled:hover,
        .btn-default-green[disabled]:hover,
        fieldset[disabled] .btn-default-green:hover,
        .btn-default-green.disabled:focus,
        .btn-default-green[disabled]:focus,
        fieldset[disabled] .btn-default-green:focus,
        .btn-default-green.disabled.focus,
        .btn-default-green[disabled].focus,
        fieldset[disabled] .btn-default-green.focus {
            background-color: #fff;
            border-color: #ccc;
        }

        .btn-default-green .badge {
            color: #fff;
            background-color: #333;
        }

    /* CSS used here will be applied after bootstrap.css */
    .btn-default-red {
        color: #333;
        background-color: #fff;
        border-color: #ccc;
    }

        .btn-default-red:focus,
        .btn-default-red.focus {
            color: #ff0000;
            background-color: #e6e6e6;
            border-color: #8c8c8c;
        }

        .btn-default-red:hover {
            color: #333;
            background-color: #e6e6e6;
            border-color: #adadad;
        }

        .btn-default-red:active,
        .btn-default-red.active,
        .open > .dropdown-toggle.btn-default-red {
            color: #ff0000;
            background-color: #e6e6e6;
            border-color: #adadad;
        }

            .btn-default-red:active:hover,
            .btn-default-red.active:hover,
            .open > .dropdown-toggle.btn-default-red:hover,
            .btn-default-red:active:focus,
            .btn-default-red.active:focus,
            .open > .dropdown-toggle.btn-default-red:focus,
            .btn-default-red:active.focus,
            .btn-default-red.active.focus,
            .open > .dropdown-toggle.btn-default-red.focus {
                color: #ff0000;
                background-color: #d4d4d4;
                border-color: #8c8c8c;
            }

    .btn-default-green:active,
    .btn-default-green.active,
    .open > .dropdown-toggle.btn-default-green {
        background-image: none;
    }

    .btn-default-red.disabled:hover,
    .btn-default-red[disabled]:hover,
    fieldset[disabled] .btn-default-red:hover,
    .btn-default-red.disabled:focus,
    .btn-default-red[disabled]:focus,
    fieldset[disabled] .btn-default-red:focus,
    .btn-default-red.disabled.focus,
    .btn-default-red[disabled].focus,
    fieldset[disabled] .btn-default-red.focus {
        background-color: #fff;
        border-color: #ccc;
    }

    .btn-default-red .badge {
        color: #fff;
        background-color: #333;
    }
</style>


<div class="row">
    <div class="col-xs-12">
        <div class="box box-danger">

            <!-- /.box-header -->
            <div class="box-body">
                <table class="table table-bordered table-hover" id="messageoverview">
                    <thead>
                        <tr>
                            <th>
                                Sender
                            </th>
                            <th>
                                Receiver
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.CourseOccurrence.Course.CourseName)
                            </th>
                            <th>
                                Request Message Text
                            </th>
                            <th>
                                @if (User.IsInRole("Study Director"))
                                {
                                    <span>Send Date & Time</span>
                                }
                                else
                                {
                                    <span>Receive Date & Time</span>
                                }
                            </th>
                            <th>
                                Respond Date & Time
                            </th>
                            @if (User.IsInRole("Study Director"))
                            {
                                <th>
                                    Respond Status
                                </th>

                                <th>
                                    Respond message Text
                                </th>
                            }
                            @if (User.IsInRole("Teacher") && !User.IsInRole("Study Director"))
                            {
                                <th>
                                    Respond Details
                                </th>
                            }
                            
                            @if (User.IsInRole("Study Director"))
                                    {

                             <th>
                                 Message Action
                             </th>
                            }
                            
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            if (item.BaseMessage.SenderID == ViewBag.CurrentTeacherId || item.BaseMessage.RecieverID == ViewBag.CurrentTeacherId)
                            {
                                if(string.IsNullOrEmpty(item.BaseMessage.MessageDeletionDate.ToString()))
                                {

                                <tr>

                                    <td>
                                        @if (User.IsInRole("Study Director"))
                                        {
                                            <span>You</span>
                                        }
                                        else
                                        {
                                            @Html.DisplayFor(modelItem => item.BaseMessage.TeacherSender.TeacherName)

                                        }
                                    </td>

                                    <td>
                                        @if (User.IsInRole("Study Director"))
                                        {
                                            @Html.DisplayFor(modelItem => item.BaseMessage.TeacherReciever.TeacherName)
                                        }
                                        else
                                        {
                                            <span>You</span>
                                        }
                                    </td>

                                    <td>
                                        @Html.DisplayFor(modelItem => item.CourseOccurrence.Course.CourseName)
                                    </td>

                                    <td>
                                        @Html.DisplayFor(modelItem => item.BaseMessage.MessageText)
                                    </td>

                                    <td>
                                        @Html.DisplayFor(modelItem => item.BaseMessage.MessageSendDate)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.BaseMessage.MessageReadDate)
                                    </td>

                                    @if (User.IsInRole("Study Director"))
                                    {
                                        <td>
                                            @if (!string.IsNullOrEmpty(item.BaseMessage.MessageReadDate.ToString()))
                                            {
                                                if (ViewBag.ResponseStatus(item.RequestApprovalMessageID) == "True")
                                                {

                                                    <span class="label label-success">Accepted</span>

                                                }
                                                else if (ViewBag.ResponseStatus(item.RequestApprovalMessageID) == "False")
                                                {


                                                    <span class="label label-danger">Rejected</span>

                                                }

                                            }
                                            else
                                            {
                                                <span class="label label-default">Not Yet Responded</span>
                                            }


                                        </td>

                                        <td>
                                            @if (!string.IsNullOrEmpty(item.BaseMessage.MessageReadDate.ToString()))
                                            {
                                                if (string.IsNullOrEmpty(ViewBag.ResponseMessage(item.RequestApprovalMessageID)) == true)
                                                {


                                                    <span class="label label-primary">No Respond Message Sent</span>

                                                }
                                                else
                                                {
                                                    <span>@ViewBag.ResponseMessage(item.RequestApprovalMessageID)</span>
                                                }
                                            }
                                            else
                                            {
                                                <span class="label label-default">Not Yet Responded</span>
                                            }
                                        </td>
                                    }





                                    @if (User.IsInRole("Teacher") && !User.IsInRole("Study Director"))
                                    {
                                        <td>
                                            @if (string.IsNullOrEmpty(item.BaseMessage.MessageReadDate.ToString()))
                                            {

                                                using (Html.BeginForm("CreateResponseApprovalMessage", "RequestApprovalMessage"))
                                                {
                                                    @Html.AntiForgeryToken()
                                                    <fieldset id="createResponseApprovalMessageForm">
                                                        <input hidden value="1" name="senderId" />
                                                        <input hidden value="33" name="receiverId" />
                                                        <input hidden value="@item.RequestApprovalMessageID" name="requestApprovalMessageId" />
                                                        <input type="text" value="" name="messageText" placeholder="Report if any concern" />
                                                        <p />
                                                        <div class="btn-group" data-toggle="buttons">
                                                            <label class="btn btn-default-green btn-sm active">
                                                                <input name="response" id="optAccept" type="radio" checked="" autocomplete="off" value="true"> <input name="response" id="optReject" type="radio" value="false" autocomplete="off"> <strong>Accept</strong>

                                                            </label>
                                                            <label class="btn btn-default-red btn-sm">
                                                                <input name="response" id="optReject" type="radio" value="false" autocomplete="off"> <strong>Reject</strong>
                                                            </label>
                                                        </div>
                                                        <p />
                                                        <p />
                                                        
                                                        <input class="btn btn-success btn-xs" value="Respond" type="submit" />
                                                    </fieldset>
                                                }
                                            }
                                            else
                                            {
                                                if (ViewBag.ResponseStatus(item.RequestApprovalMessageID) == "True")
                                                {

                                                    <span class="label label-success">Accepted</span>

                                                }
                                                else if (ViewBag.ResponseStatus(item.RequestApprovalMessageID) == "False")
                                                {


                                                    <span class="label label-danger"> Rejected</span>

                                                }
                                                <br />


                                                if (string.IsNullOrEmpty(ViewBag.ResponseMessage(item.RequestApprovalMessageID)))
                                                {
                                                    <span> No Respond Message Sent</span>
                                                }
                                                else
                                                {
                                                    <span> <strong>Responded Message:</strong> </span>
                                                    <span>@ViewBag.ResponseMessage(item.RequestApprovalMessageID) </span>
                                                }
                                            }

                                        </td>
                                    }
                                    @if (User.IsInRole("Study Director"))
                                    {
                                    <td>
                                      @if (!string.IsNullOrEmpty(item.BaseMessage.MessageReadDate.ToString()))
                                            {
                                        using (Html.BeginForm("DeleteApprovalMessage", "RequestApprovalMessage"))
                                        {
                                        @Html.AntiForgeryToken()
                                        <fieldset id="createResponseApprovalMessageForm">
                                            <input hidden value="1" name="senderId" />
                                            <input hidden value="33" name="receiverId" />
                                            <input hidden value="@item.RequestApprovalMessageID" name="deleteApprovalMessageId" />
                                           
                                            <p />
                                      
                                            <p />
                                            <p />

                                            <input class="btn btn-danger btn-sm pull-right"  value="Delete" type="submit" />
                                        </fieldset>
                                        }
                                      }
                                    </td>

                                    }
                                    
                                </tr>
                            }
                            }
                        }
                    </tbody>
                </table>
            </div>
            <!-- /.box-body -->
        </div>
        <!-- /.box -->
    </div>
    <!--/.col-xs-12-->
</div>
@section MyScripts{
    <script>
        $(document).ready(function () {
            $('#messageoverview').DataTable()
        });



    </script>
}


